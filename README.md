# ndstore

Это пока набросок.

Проект распределенной сетевой системы хранения файлов 
- С избыточными даннными для восстановления недоступных блоков 
- Контролем целостности.

Текущий код создавался с требованиями
- Ясность и простота конструкции и самого кода
- Реализовать действительно необходимую функциональность
- Отсутствие преждевременной оптимизации 
- Минимальное количество зависимостей как внутренних, так и внешних
- Возможность замены компонент
- Дез-интеграция и интеграция в/из внешнего мини/микро-сервиса
- Практичность и ясность в эксплуатации

![](/docs/toplev-draft1.svg?raw=true "Полная схема")


Для хранения метаданных на данный момент использована абстракция к реляционной DBMS, 
с минимальным использованием возможностей последней. К примеру, все запросы максимально атомизированы.
В дальнейшем, когда будут выяснены реляционные зависимости, 
реляционная DBMS возможно будет заменена на keyvalue system, без нарушения поведения всей системы.

![](/docs//conc-draft.svg?raw=true "Упрощенная объектная схема схема")

Абстракция к DBMS представлена интерфейсом с соотвествующим поведением.
DBMS является ключевой системой и явным узлом отказа всей системы храннения данных, 
с соотвествующими требованиями в эксплуатации, поэтому выбор сводиnся наиболее проверенным 
и наименее экзотическим продуктам.

Проект в разработке, тем не менее на данный момент является рабочим.

```
# fstorecli saveFile -local ~/block.bin -remote file2.bin
{
  "error": false,
  "result": {}
}

# fstorecli loadFile -remote file2.bin -local ~/file2.bin
{
  "error": false,
  "result": {}
}

# md5 ~/block.bin ~/file2.bin 
MD5 (block.bin) = a44122b223ac55dcbebdf6e482a39604
MD5 (file2.bin) = a44122b223ac55dcbebdf6e482a39604

# fstorecli listFiles
{
  "error": false,
  "result": {
    "entries": [
      {
        "entryId": "10164",
        "userId": 9,
        "dirPath": "/",
        "fileName": "file1.bin",
        "fileId": 10179,
        "userName": "admin",
        "fileSize": 1073741824,
        "updatedAt": "2022-07-07T13:02:29+02:00",
        "createdAt": "2022-07-07T13:02:21+02:00"
      },
      {
        "entryId": "10165",
        "userId": 9,
        "dirPath": "/",
        "fileName": "file2.bin",
        "fileId": 10180,
        "userName": "admin",
        "fileSize": 1073741824,
        "updatedAt": "2022-07-07T13:04:08+02:00",
        "createdAt": "2022-07-07T13:04:03+02:00"
      }
    ]
  }
}
```

Текущая схема выглядит как на схеме ниже. В дальнейшем предполагается часть логики вынести в отдельный сервис регистра/координатора. 

![](/docs/toplev-draft0.svg?raw=true "Рабочая схема")


