package config

import (
    "encoding/json"
    "path/filepath"
    "os"
)


const configName string = "@srv_conf@"

type Config struct {
    Port        string      `json:"port"`
    ConfDir     string      `json:"confdir"`
    DataDir     string      `json:"datadir"`
    LogDir      string      `json:"logdir"`
    RunDir      string      `json:"rundir"`
}

func NewConfig() *Config {
    var config Config
    config.RunDir   = "@srv_rundir@"
    config.LogDir   = "@srv_logdir@"
    config.DataDir  = "@srv_datadir@"
    config.ConfDir  = "@srv_confdir@"
    config.Port     = "@srv_port@"
    return &config
}

func (this *Config) Read() error {
    var err error
    filename := filepath.Join(this.ConfDir, configName)
    confData, err := os.ReadFile(filename)
    err = json.Unmarshal(confData, this)
    if err != nil {
        return err
    }
    return err
}
